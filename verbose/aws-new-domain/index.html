<!DOCTYPE html>
<html lang="en-us" >

    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="chrome=1">
        <meta name="HandheldFriendly" content="True">
        <meta name="MobileOptimized" content="320">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="referrer" content="no-referrer">
        <meta name="description" content="
        
            I moved my site&#39;s blog to its own domain without breaking old links or losing comments. Here&#39;s how.
        
        ">

        <meta property="og:title" content="Moving to a new domain without breaking old links: AWS &amp; Disqus">
        <meta property="og:description" content="
        
            I moved my site&#39;s blog to its own domain without breaking old links or losing comments. Here&#39;s how.
        
        ">
        <meta property="og:image" content="
        
            https://vickylai.com/pixels/aws-moving.png
        
        ">
        <meta property="og:url" content="https://vickylai.com/verbose/aws-new-domain/">

        <meta name="twitter:image" content="
        
            https://vickylai.com/pixels/aws-moving.png
        
        ">
        <meta name="twitter:card" content="summary_large_image">

        <title>
        
            Moving to a new domain without breaking old links: AWS &amp; Disqus
        
        </title>

        <link rel="canonical" href="https://vickylai.com/verbose/aws-new-domain/">
        
        <link rel="stylesheet" href="/css/style.css">
        
        <link rel="shortcut icon" href="/img/logo.ico" id="favicon">
        
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-98623582-1"></script>
        <script>
            window.dataLayer = window.dataLayer || [];

            function gtag() {
                dataLayer.push(arguments);
            }
            gtag('js', new Date());

            gtag('config', 'UA-98623582-1');
        </script>
        
        
        <script src="/js/mode.js"></script>
    </head><body><div id="top"></div><div id="logo"><img id="up" src="/img/vx50.png" width="25px"/><img id="night" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAG8AAABvCAYAAADixZ5gAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAATISURBVHhe7d1pqK1THMfxYx4yT5FIkpCbKGXqoiSSMubexL0lt3uTUpLppUJkFqIoETKEeEGU4QVJCCFJxAtkzCzT99e9O6ftf85&#43;9rPXetba&#43;/l96/PmKp2zVvvsZ1jPeuacc84555xzzjnnnHPOObe29bAUd2A7/YOrv61wMT7BP3gIrvJ2xrX4AZq0gUPgKm0zXI4fMX/S5BW4SjsVn2J40gaWwVXWDngQ0YQN/AJ9Kl1FHYMvEU3YfI/DVZIO/S/Dn4gma9g5cBW0KR5FNEmRv7ATXOG2xguIJmkhPsqsoB3xJqIJWsx1cAXTJ&#43;51RJMzymlwhdocLyKamCb2hiuQjiofQTQpTfyBDeEKpEtd0aQ09SFcgY5H0/O4hTwP13E6svwC0YSM4wG4jhvnJHwxt8F12JmIJqKNa&#43;A6agt8jmgi2rgKrqOuQDQJbfmT11G74VdEk9CWv/M66kZEEzCJ&#43;&#43;Eyp7vhPyOagEk8AZe51N91Ay/BZWwDpDzCnE8n&#43;i5jugwWDXwq28BlSquYo0FPxQttM7UJogWyKa2Ay9CxiAY8pTvhMnQTogFP6SO4DL2LaMBT2x0uYboIPenN1qZWwiXsSEQDncOTcAm7ANFA56CFSLo77xJ1K6KBzuV8uEQ9hWiQc9GiXZeotxENck6HwyXoa0QDnNPTcAnKfVks8jcOgpuwaHC7oGWFboL08Eg0sF3Qp&#43;8ouJatj2hgu/IeNoJrWY41K&#43;O4BK5lKZ5FmMRP8LN7LdOtmmhQu/QGtEGBGzM96B8NaNduhxuzexENZglnwI2RNsGJBrIEHTwdDdcw7dIQDWQp32MJXIP2QzSIJX2GPeFGpBP1EhenR9Hq7f3hRvQwogEs7VscAbdI5yEavBpoj86T4BZoH0QDVwtdxL4evg66QO8gGria6IKC134GXYRowGrzDc6FDrTcunaFNjSNBqxGr&#43;JAuHU9g2igaqWV3no7yh7ofbkfsMxFi3nvRu9vLbXdDLUG&#43;rOvHeR1aqFnDnvXKYgGZtrowEarwbVOZmPkbBdUcTFBR3ElFuLmpLsVz&#43;JSHIZtMUl7QbevtG/2YKxOQBXptoxOjIcHYZboJR7advkuXAm9ZWwNzsbp0ONoq6B/1yRpp9/X8B2G/1/Poaruw/APaf&#43;ng6XqbmHp9Wm6txb9wPYfbTxUZXp9TPQD21pad1r1Ua02fYt&#43;8L7TQVD1d/z1zPoHiH6BPtPBzFR0AEqvrK7J1O0fehx&#43;R/TL9IleM5D7pD9L2jR81s//FqOV3Xqf0tR2IaJfbNbpSoo2k5369GXd1cY7NdAr52ZqC5KTkXoj8Rrp0pde0j9zLcVXiH7pWXAPpvLgpGlaPqE9pKNfflr9htXoRXo33tWYhSPR93Ewepf&#43;jHa1/WNqugt/A3r9En4tjNUywhL7u7T1MrwSbV56rY2edtX3RzRgNdBdgWXQa1VdkA5o9OdIGwdEA1jCW9CkeeFuw3R1Qts1llqdpgdWtDrAm9ZN2L7QuhFduci5Slvfu49hObaES9z20HLDW6AHSbRkL5qIUXSa8jG0blNvlz4Ufr13gXQdUesgz4JWdGkFlz6pN0MruXROqWV8&#43;m8nQkeKM3kJyznnnHPOOeecc8455&#43;pvbu5fjNkvXpWc9JIAAAAASUVORK5CYII=" width="25px"/><img id="day" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAABgCAYAAADimHc4AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAX2SURBVHhe7ZxbaBxVGMcj9YqgUhARvEWL4oP1UrDeNV6wUq3UID4UbKpUqilSEAVBwYJB6YO0FKWp0NCkZk2yS1BKivUhT/ZBFBXBvvmYYpW2XkqVFuPvq9/A7MnZzW4yM2d25vvBn9mdc&#43;ac7/y/mdm5bpdhGIZhGIZhGC1Tq9WunJiY2IiW6ywjK0ZGRi4ZHx&#43;fwfxZdAat1CIjC8bGxh5T8yO9o0VGFpCA1U4C3tMiIwssAYGxBATGEhAYS0BgLAGBsQQExhLQgKGhoQtrtdpdnKVeqrNSIesETE1NXUAf909OTl6ms/LH9PT0uRj/tRrya7VavVeLEifLBMg1J8b1o/ZzlL67tShfENgtMUNmCfqPtJKQVQLU/MPxvvj&#43;mhbnC71A9osTbCpJqFQqNzr9bNCixGhg/r9pbtmLRoIT0&#43;NBo9/TCJp2&#43;&#43;nre6Y7BwcHz9PZidDIfLa8zVolv2SZhDRoZD7Tfq2Sf8RsMT0&#43;CPme9yQUwvyITktCocyP6JQkFNL8iEZJQLm4l6tHb8U0P8KXBAb5pRa3jBztcCRyE1rD8hvQS7S1ke9rmd4&#43;PDx8sVZtGZbbGsUkKpz5EZ4kfKZFTcHcpZjyCvUPoL9iy88R9U4zPcT0Lfq7XptoCvVfjS1fTPMjGNxydJCBfs7J1HU62wvGd1N3F3X/FnPalZq5n3bu1ia9yPUr6g2iQ&#43;gZnV1e9MLX1oUa70oSgUZGR0ev0C6MRrC2LsO0b1wTE9IRdks92pXhgvl3sqb&#43;5jEuMdH&#43;adSnXRoRmLMS/Rk3Ky3JLonpJu3akKMVDDkaNykDnWGLW60hlBf5wWWN/NZjUBY6RvKv1VDKCSbUnQRlLZL/hYZSPmTXgwGJHGouRsTRqyGVCwa/yzUjhFgJfpidnT1HwyoH/AAuZfCnXDNCia3gUQ2tHJCAl31GhBJbwYiGVg4YtFxY85oRQiTgOFqi4RUbeX6IQTe9qhlCJGCFhlhsKpXKzT4DQovd4osaYr6QkxX5kWpH8tyOLj4HBrrGZ0AOtE1DnEOtVrvVN85Goq1HErn6Kg2hfzTAduW9scGm3uepmwd9rCHWQbxveurOK5Y7ycrW9F7EvNDQXrfhNvSdNlNH3o6AYvpEQ6yD&#43;T879drRTm1mYdDAC06D7ehDbaYO2dd66uZBQxpiHczf49RrWYz1OW1m4bBP62VzGkDvt6G&#43;Ro8LEtizbqA50XYNsQ5MvIiyTZ4xNtMAy63SJvIFwd3mDDwvKu7N&#43;Djy6AhJkKcXfCaE1EMaYvEhAV95DAipU7Kr0fCKDwN&#43;2zEgqFghpjS0csDa1s2g5d6s15CsRSzrNLTywMD3u0aEEObPyMNZGlZ54PRe3qYMvhUQwxYNqXxgwD7XkCyF&#43;YeTfr2po5ALVhhxxDUmI8k/bd2joZQXfpAfVjN8JqUm&#43;n1dQzAwZH3GvwcfaddGBAmQly1S3xLoZzcqx&#43;3HdqlWq09h0jHXtCSE6fJg7hvaldEITLoGww66Bi5SP9HufdpFeZF/G&#43;HHbzOGPKmzGkK9tZgmb8L7DG1JLD&#43;DtqDztVkvbHkPSD2mLb3W1JF4XgWd9xFxeWJN77HuY9njsWWbSR74OkD9da2c4RLXHdQ/&#43;9vDMqn9wUhQfO/hok&#43;1uCVYfglawZYhd9S28Xk303G0h887mPZjXg/lbV3VpH7dLVLaKlYSfObzXQ45n9YqQSG&#43;q4jlhBNfMZLQxPxc3X0Ss8V0J87OTkKnmB9RqCR0mvkRhUhCp5of0dFJyNJ8DOmh3b1yFKOzEqMjkyDH3ARZd&#43;KUlvmVSuVq2o0/Mpn4Xwz4koBOkPBlWiVfEHBvPNi0zBdo9wmnrwEtSpQGW8IHWpwvWDPkRvvZl&#43;7EfL6n9gd3tJ3Z/4Z6krBei/IHxjxIgNvFIJ2VClkmQGCXd4Os&#43;ej50r3Q5yPrBBgOloDAWAICYwkIjCUgMJaAwFgCAmMJCAwJWOUk4F0tMrKABFzOWenJKAHVavVxLTKyovb/4&#43;07SMbiXwU1DMMwDMMwDMPIjK6u/wD&#43;dHqz7NmcyQAAAABJRU5ErkJggg==" width="25px"/></div><div class="menu-mobile"><a href="/verbose">verbose</a> &#183;
<a href="https://vickylai.com/">vickylai.com</a></div><div class="menu no-mobile"><p><a href="/verbose">verbose</a> &#183;

<a href="/#work">work</a>

&#183; <a href="mailto:hello@vickylai.com">email</a>
&#183; <a href="https://vickylai.com/">vickylai.com</a></p></div><div class="wrap contain"><div id="featuredimg"><img src="/pixels/aws-moving.png"/></div><div id="content"><h1>Moving to a new domain without breaking old links: AWS &amp; Disqus</h1><p id="date">Wed Jan 10, 2018 &#183; 3 min read</p>
<div><span id="tag"><a href="/tags/aws">aws</a></span>

&#183; <span id="tag"><a href="/tags/config">config</a></span>
&#183; <span id="tag"><a href="/tags/websites">websites</a></span></div><hr id="accent-hr"/>


<p>I started blogging about my nomadic travels last year, and so far the habit has stuck. Like all side projects, I won&rsquo;t typically invest heavily in setting up web properties before I can be reasonably certain that such an investment is worth my time or enjoyment. In other words: don&rsquo;t buy the domain until you&rsquo;ve proven to yourself that you&rsquo;ll stick with it!</p>

<p>After some months of regular posting I felt I was ready to commit (short courtship, I know, but we&rsquo;re all adults here) and I bought a dedicated domain, <a href="https://heronebag.com">herOneBag.com</a>.</p>

<p>Up until recently, my #NomadLyfe blog was just a subdirectory of my <a href="https://vickylai.com">vickylai.com</a> domain. (This was my original sole domain before I got caught up in the &ldquo;.io&rdquo; excitement and bought vickylai.io, which I then cooled off of and moved back to &ldquo;.com&rdquo;, but that&rsquo;s a whole other blog post&hellip;) Here&rsquo;s the setup for the site:</p>

<ul>
<li>Static site in Amazon Web Services S3 bucket</li>
<li>Route 53 handling the DNS</li>
<li>CloudFront for distribution and a custom SSL certificate</li>
<li>Disqus for comments</li>
</ul>

<p>If you&rsquo;d like a walk-through for how to set up a new domain with this structure, it&rsquo;s over here: <a href="https://vickylai.com/verbose/aws-static-site/">Hosting your static site with AWS S3, Route 53, and CloudFront</a>. In this post, I&rsquo;ll just detail how I managed to move my blog to the new site without breaking the old links or losing any comments.</p>

<h1 id="preserve-old-links-with-redirection-rules">Preserve old links with redirection rules</h1>

<p>I wanted to avoid breaking links that have been posted around the web by forwarding visitors to the new URL. The change looks like this:</p>

<p>Old URL: <code>https://vickylai.com/meta/5-bag-lessons/</code><br />
New URL: <code>https://heronebag.com/blog/5-bag-lessons/</code></p>

<p>You can see that the domain name as well as the subdirectory have changed, but the slug for the blog post remains the same. (I love static sites.)</p>

<p>To redirect links from the old site, we&rsquo;ll need to set redirection rules in the old site&rsquo;s S3 bucket. AWS provides a way to set up a conditional redirect. This is set in the &ldquo;Redirection rules&rdquo; section of your S3 bucket&rsquo;s properties, under &ldquo;Static website hosting.&rdquo; You can <a href="https://docs.aws.amazon.com/AmazonS3/latest/dev/how-to-page-redirect.html#advanced-conditional-redirects">find the documentation here.</a></p>

<p><img src="/pixels/aws-redirect.png#screenshot" alt="Redirection rules placement" /></p>

<p>There are a few examples given, but none that represent the redirect I want. In addition to changing the prefix of the object key, we&rsquo;re also changing the domain. The latter is achieved with the <code>&lt;HostName&gt;</code> tag.</p>

<p>To redirect requests for the old blog URL to the new top level domain, we&rsquo;ll use the code below.</p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;RoutingRules&gt;</span>
  <span class="nt">&lt;RoutingRule&gt;</span>
    <span class="nt">&lt;Condition&gt;</span>
      <span class="nt">&lt;KeyPrefixEquals&gt;</span>oldblog/<span class="nt">&lt;/KeyPrefixEquals&gt;</span>
    <span class="nt">&lt;/Condition&gt;</span>
    <span class="nt">&lt;Redirect&gt;</span>
      <span class="nt">&lt;HostName&gt;</span>newdomain.com<span class="nt">&lt;/HostName&gt;</span>
      <span class="nt">&lt;ReplaceKeyPrefixWith&gt;</span>newblog/<span class="nt">&lt;/ReplaceKeyPrefixWith&gt;</span>
    <span class="nt">&lt;/Redirect&gt;</span>
  <span class="nt">&lt;/RoutingRule&gt;</span>
<span class="nt">&lt;/RoutingRules&gt;</span></code></pre></div>
<p>This rule ensures that requests for <code>olddomain.com/oldblog/specific-blog-post</code> will redirect to <code>newdomain.com/newblog/specific-blog-post</code>.</p>

<h1 id="migrate-disqus-comments">Migrate Disqus comments</h1>

<p>Disqus provides a tool for migrating the comment threads from your old blog site to the new one. You can find it in your Disqus admin tools at <code>your-short-name.disqus.com/admin/discussions/migrate/</code>.</p>

<p>To migrate posts from the old blog address to the new one, we&rsquo;ll use the URL mapper tool. Click &ldquo;Start URL mapper,&rdquo; then &ldquo;you can download a CSV here.&rdquo;</p>

<p><img src="/pixels/aws-disqus.png#screenshot" alt="URL mapping for Disqus." /></p>

<p>Disqus has decent instructions for how this tool works, and you can <a href="https://help.disqus.com/customer/en/portal/articles/912757-url-mapper">read them here.</a> Basically, you&rsquo;ll input the new blog URLs into the second column of the CSV file you downloaded, then pass it back to Disqus to process. If you&rsquo;re using a program to edit the CSV, be sure to save the resulting file in CSV format.</p>

<p>Unless you have a bazillion URLs, the tool works pretty quickly, and you&rsquo;ll get an email when it&rsquo;s finished. Don&rsquo;t forget to update the name of your site in the Disqus admin, too.</p>

<h1 id="transfer-other-settings">Transfer other settings</h1>

<p>Update links in your social profiles and any other sites you may have around the web. If you&rsquo;re using other services attached to your website like Google Analytics or IFTTT, don&rsquo;t forget to update those details too!</p>
<p>Like this post? Questions? <a href="https://twitter.com/intent/tweet?text=@hivickylai:%20I%20just%20read%20https%3a%2f%2fvickylai.com%2fverbose%2faws-new-domain%2f%20and..." onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">Tweet me about it!</a></p></div><div class="go-center"><hr id="accent-hr"/></div><div class="related"><h2>An algorithm thinks these posts are related...</h2><ul> <li><a href="/verbose/free-twitter-bot-aws-lambda/">Running a free Twitter bot on AWS Lambda</a></li><li><a href="/verbose/aws-static-site/">Hosting your static site with AWS S3, Route 53, and CloudFront</a></li><li><a href="/verbose/delete-old-tweets-ephemeral/">Why I&#39;m automatically deleting my old tweets using AWS Lambda</a></li></ul></div><div class="footer"><img id="bio-avatar" src="/img/purple-avatar-v2.png" width="120px"/><div id="bio"> <strong>Vicky Lai</strong><p>I&#39;m a freelance full stack developer with an entrepreneurial background and keen interest in building technology for social good.</p><div id="bio-menu"><p><a href="https://github.com/vickylai">github</a>

&#183; <a href="https://mastodon.social/@vickylai">mastodon</a>
&#183; <a href="https://twitter.com/hivickylai">twitter</a>
&#183; <a href="mailto:hello@vickylai.com" rel="noopener">email</a></p></div></div></div><script>
    scrollTo = (element) => {
        window.scroll({
            behavior: 'smooth',
            left: 0,
            top: element.offsetTop
        });
    }

    document.getElementById("up").addEventListener('click', () => {
        scrollTo(document.getElementById("top"));
    });
</script></div></body>